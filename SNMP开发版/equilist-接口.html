<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Helios </title>
		<link rel="stylesheet" href="assets/css/bootstrap.min.css?2019827" />
		<link rel="stylesheet" href="assets/css/global.css?2019827" />
		<!-- Font Awesome -->
		<link rel="stylesheet" href="assets/css/font-awesome.min.css?2019827" />
		<!-- Theme style -->
		<link rel="stylesheet" href="assets/css/AdminLTE.min.css?2019827" />
		<link rel="stylesheet" href="assets/css/skins/skin-black.min.css?2019827" />
		<link rel="stylesheet" href="assets/css/index.css?2019827">
	</head>
	<style>
		.viswCard span {
	color: #fff;
	margin-right: 0px;
	}
	.box-header .el-button--mini, .el-button--mini.is-round {
		padding: 1px 3px;
		color: #fff;
	   vertical-align: middle;
	}
	.el-input{
		vertical-align: middle;
	}
	.label-text-vm {
	    text-align: left;
	}
</style>

	<body class="skin-black sidebar-collapse sidebar-mini">
		<!-- hold-transition skin-blue-light sidebar-mini sidebar-collapse -->
		<div class="wrapper">
			<!-- 页头 -->
			<div id="comp-header" class="main-header" style="position: relative; z-index: 99;">
				<el-main-header :loguser="logUserName"></el-main-header>
			</div>
			<!-- 页头end -->

			<!-- 侧边栏导航 -->
			<div id="comp-sidebar">
				<el-main-sidebar></el-main-sidebar>
			</div>
			<!-- 侧边栏导航 end -->

			<!-- 内容区域 -->
			<div class="content-wrapper" id="content-wrapper">

				<!-- 内容头部面包屑 -->
				<section class="" style="display: none">
					<ol class="breadcrumb">
						<li>
							<a id="head1" href="#"></a>
						</li>
						<li id="head2" class="active"></li>
					</ol>
				</section>
				<!-- 主要内容显示 -->
				<section class="content container-fluid" id="MainContext" style="padding:15px; min-width: 1200px;">

					<div class="row">
						<!-- LEFT START -->
						<div class="col-xs-12">
							<div class="box">
								<div class="box-header">
									<h3 class="box-title">设备管理</h3>
									<div class="viswCard" style="right: 94px;">
										<el-input v-model="tableDataName" size="mini" placeholder="请输入设备名称" style="width:240px"></el-input>
										<el-button type="primary" size="mini" @click="doFilter">搜索</el-button>
									</div>
									<div class="viswCard">

										<el-button type="success" size="mini" @click="openData">数据同步</el-button>
									</div>
								</div>
								<div class="box-body table-responsive no-padding">

									<el-table :data="tableDataEnd" border style="width: 100%" ref="articleTable">


										<el-table-column prop="data2" label="设备名称" :formatter="substr_name">
										</el-table-column>
										<el-table-column prop="data3" label="设备类型">
										</el-table-column>
										<el-table-column prop="data4" label="版本类型">
										</el-table-column>

										<el-table-column prop="data5" label="部署地点">
										</el-table-column>
										<!--<el-table-column prop="switch" label="在线状态" :formatter="selcome_swit">
										</el-table-column> -->

										<el-table-column prop="data6" label="在线状态">
											<template slot-scope="{row}">
												<span v-if="row.data6 ===1" style="color:#409EFF;"> <i class="fa fa-fw fa-link"></i>在线</span>
												<span v-if="row.data6 ===0" style="color:#ff851b;"> <i class="fa fa-fw  fa-unlink "></i>掉线</span>


											</template>
										</el-table-column>

										<el-table-column label="操作" width="400">
											<template slot-scope="{row}">
												<el-button size="mini" icon="el-icon-edit" type="primary" @click.native.prevent="lookmax(row.data1,tableDataEnd)">查看设备</el-button>
												<el-button size="mini" icon="el-icon-setting" type="primary" @click.native.prevent="setmax(row.data1,tableDataEnd)">配
													置</el-button>
												<el-button size="mini" icon="el-icon-receiving" type="primary" @click.native.prevent="backup(row.data1,row.data2)">备
													份
												</el-button>
												<el-button size="mini" icon="el-icon-delete" type="danger" @click.native.prevent="delerow(row.data1,tableDataEnd)">删除</el-button>

											</template>
										</el-table-column>
									</el-table>
									<div style="text-align: center;">
										<el-pagination background @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage"
										 :page-sizes="[5, 24, 30]" :page-size="pageSize" layout="total, sizes, prev, pager, next" :total="totalItems">
										</el-pagination>
									</div>

								</div>

							</div>
							<!-- events log  end-->
						</div>

					</div>


				</section>
			</div>

		</div>
		<script type="text/javascript" src="assets/js/jquery.js"></script>
		<script type="text/javascript" src="assets/js/vue.js"></script>
		<script type="text/javascript" src="assets/js/index.js"></script>
		<script type="text/javascript" src="assets/js/comment.js"></script>
		<script type="text/javascript" src="assets/js/adminlte.js"></script>

		<script type="text/javascript">
			var app;
			let data = {
				tableDataBegin: [

				],
				tableDataName: "",
				tableDataEnd: [],
				currentPage: 1,
				pageSize: 5,
				totalItems: 2,
				filterTableDataEnd: [],
				flag: false,
				Switch: false,
				Switch1: true,
				delVisible: false,
				multipleSelection: [],

			};
			app = new Vue({
				el: "#content-wrapper",
				data: data,
			  
				mounted() { 
					$("body").resize();
					this.getdata(); 
				},

				beforeMount() {
					this.getuquilist();
				},

				methods: {
					getuquilist() {
						var token = sessionStorage.getItem("$token");
						var obj = {
							token: token,
						}
						let dataajax = [];
						util.getattrajax(SNMPAPI.getList, obj, function(data) {
							var obj1 = {
								data1: "",
								data2: "",
								data3: "",
								data4: "",
								data5: "",
								data6: "",
							}

							for (var i in data) {

								var obj1 = {
									data1: data[i].sn,
									data2: data[i].sn,
									data3: data[i].sn,
									data4: data[i].sn,
									data5: data[i].sn,
									data6: data[i].type,
								}

								/* console.log(data[i].sn);
								obj1.data1 = data[i].sn;
								obj1.data2 = data[i].sn;
								obj1.data3 = data[i].sn;
								obj1.data4 = data[i].sn;
								obj1.data5 = data[i].sn;
								obj1.data6 = data[i].sn; */
								dataajax.push(obj1);
							}
							
							console.log(dataajax);

						})

						/* 
						$.ajax({
							type: "GET",
							url: "http://192.168.90.34:8089/snmp/device/getList",
							dataType: 'json',
							async: true,
							data: {
								token: token
							},
							headers: {
								token: token
							},
							success: function(data) {
								console.log(data);
							},
							error: function(data) {
								console.log(data);
							},
							beforeSend: function(data) {
								console.log(data);
							},
							complete: function(data) {
								console.log(data);
							}
						}); */
					},

					/* 初始进入系统请求数据 */
					getdata() {
						/* 	let url = "http://jsonplaceholder.typicode.com/users";
							util.getattrajax(url, function(data) { */

						var dataajax = [{
								data1: 1,
								data2: "数据11...",
								data3: "数据...",
								data4: "数据...",
								data5: "数据...",
								data6: 0,
							},
							{
								data1: 2,
								data2: "数据22...",
								data3: "数据...",
								data4: "数据...",
								data5: "数据...",
								data6: 0,
							},
							{
								data1: 3,
								data2: "数据33...",
								data3: "数据...",
								data4: "数据...",
								data5: "数据...",
								data6: 1,
							},
							{
								data1: 4,
								data2: "数据44...",
								data3: "数据...",
								data4: "数据...",
								data5: "数据...",
								data6: 1,
							}
						];



						if (this.totalItems > this.pageSize) {
							this.totalItems = dataajax.length;
							for (let index = 0; index < this.pageSize; index++) {
								this.tableDataEnd.push({
									data1: dataajax[index].data1,
									data2: dataajax[index].data2,
									data3: dataajax[index].data3,
									data4: dataajax[index].data4,
									data5: dataajax[index].data5,
									data6: dataajax[index].data6,
								});
							}
						} else {
							this.tableDataEnd = dataajax;

						}
						dataajax.forEach((value, index) => {
							this.tableDataBegin.push({
								data1: value.data1,
								data2: value.data2,
								data3: value.data3,
								data4: value.data4,
								data5: value.data5,
								data6: value.data6,
							});
						})
						toast.$message({
							message: '数据同步成功',
							type: 'success',
							offset: 80
						});
						/* }); */
					},
					/* 初始进入系统请求数据  end*/

					//组件自带监控当前页码  start**************
					//前端搜索功能需要区分是否检索,因为对应的字段的索引不同
					//用两个变量接收currentChangePage函数的参数
					handleSizeChange(val) {
						console.log(`每页 ${val} 条`);
						this.pageSize = val;
						this.handleCurrentChange(1);
					},
					handleCurrentChange(val) {
						//console.log(`当前页: ${val}`);
						this.currentPage = val;
						//需要判断是否检索
						if (!this.flag) {
							this.currentChangePage(this.tableDataBegin);
							console.log(this.tableDataEnd);
						} else {
							this.currentChangePage(this.filterTableDataEnd);
							console.log(this.tableDataEnd);
						}
					},
					//全局数据联动查询 方法**********************
					currentChangePage(list) {
						let from = (this.currentPage - 1) * this.pageSize;
						let to = this.currentPage * this.pageSize;
						this.tableDataEnd = [];
						for (; from < to; from++) {
							if (list[from]) {
								this.tableDataEnd.push(list[from]);
							}
						}
					},

					//组件自带监控当前页码   end**************


					//搜索 **********************
					doFilter() {
						if (this.tableDataName == "") {
							this.$message.warning("查询条件不能为空！");
							return;
						}
						this.tableDataEnd = []
						//每次手动将数据置空,因为会出现多次点击搜索情况
						this.filterTableDataEnd = []
						this.tableDataBegin.forEach((value, index) => {
							if (value.name) {
								if (value.name.indexOf(this.tableDataName) >= 0) {
									this.filterTableDataEnd.push(value)
								}
							}
						});
						//页面数据改变重新统计数据数量和当前页
						this.currentPage = 1
						this.totalItems = this.filterTableDataEnd.length
						//渲染表格,根据值
						this.currentChangePage(this.filterTableDataEnd)
						//页面初始化数据需要判断是否检索过
						this.flag = true
					},

					//设备备份
					backup: function(index, rows) {
						toast.$confirm("备份 【  " + rows + " 】 是否继续", "提示", {
							confirmButtonText: "确定",
							cancelButtonText: '取消',
							type: "warning"
						}).then(() => {
							this.$message.success(rows + " 备份 成功");
						});
					},

					//删除**********************
					delerow: function(index, rows) {

						toast.$confirm("此操作将永久删除该数据，是否继续", "提示", {
							confirmButtonText: "确定",
							cancelButtonText: '取消',
							type: "warning"
						}).then(() => {
							rows.splice(index, 1);
							/* toast.$notify({
								title: '成功',
								message: '删除成功',
								type: 'success',
								duration: 1000
							}); */
							this.$message.success("删除成功");
						});
					},





					//查看设备
					lookmax(index, value) {
						console.log(index);

						/* let url = "http://jsonplaceholder.typicode.com/users/" + index;
						util.getattrajax(url, function(data) {
							console.log(data);
						}); */
						window.location.href = 'Basicinfo.html';
						sessionStorage.setItem("lookmax", index);

					},

					//设置设备
					setmax(index) {
						window.location.href = 'configuration.html';
						sessionStorage.setItem("setmax", index);
					},




					//数据同步**********************
					openData() {
						this.tableDataName = "";
						//this.tableDataEnd = this.tableDataBegin;
						//每次手动将数据置空,因为会出现多次点击搜索情况
						util.success("数据同步成功");
						this.filterTableDataEnd = []
						this.tableDataBegin.forEach((value, index) => {
							this.filterTableDataEnd.push(value);
						});
						this.currentPage = 1;
						this.totalItems = this.filterTableDataEnd.length;
						this.currentChangePage(this.filterTableDataEnd);
						this.flag = true;
					},

					//设备状态***********
					selcome_swit(row, column, cellValue, index) {
						if (cellValue === 1) {
							return "正常";
						} else {
							return "失效";
						}
					},
					substr_name(row, column, cellValue, index) {
						let val = "";
						val = cellValue.substring(0, 6) + "...";
						return val;
						//console.log(cellValue)
					}

				},

			})
		</script>
	</body>
</html>
