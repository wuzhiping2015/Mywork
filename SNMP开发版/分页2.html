<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Helios </title>
		<link rel="stylesheet" href="assets/css/bootstrap.min.css?2019827" />
		<link rel="stylesheet" href="assets/css/global.css?2019827" />
		<!-- Font Awesome -->
		<link rel="stylesheet" href="assets/css/font-awesome.min.css?2019827" />
		<!-- Theme style -->
		<link rel="stylesheet" href="assets/css/AdminLTE.min.css?2019827" />
		<link rel="stylesheet" href="assets/css/skins/skin-black.min.css?2019827" />
		<link rel="stylesheet" href="assets/css/index.css?2019827">

		<script type="text/javascript" src="assets/js/jquery.js"></script>
		<script type="text/javascript" src="assets/js/vue.js"></script>
		<script type="text/javascript" src="assets/js/index.js"></script>

	</head>
	</style>

	<body class="skin-black sidebar-collapse sidebar-mini">

		<!-- 页头 -->
		<div id="comp-header" class="main-header" style="position: relative; z-index: 99;">
			<el-main-header :loguser="logUserName" :logUser="logUserName"></el-main-header>
		</div>
		<!-- 页头end -->

		<!-- 侧边栏导航 -->
		<div id="comp-sidebar">
			<el-main-sidebar></el-main-sidebar>
		</div>
		<!-- 侧边栏导航 end -->

		<!-- 内容区域 -->
		<div class="content-wrapper" id="content-wrapper">
			<div style="padding-top: 250px;">
				<el-input v-model="tableDataName" placeholder="请输入姓名" style="width:240px"></el-input>
				<el-button type="primary" @click="doFilter">搜索</el-button>
				<el-button type="primary" @click="openData">展示数据</el-button>
				<el-table :data="tableDataEnd" border style="width: 100%">
					<el-table-column prop="PackingId" label="包装编号" width="120">
					</el-table-column>

					<el-table-column prop="date" label="日期" width="180">
					</el-table-column>
					<el-table-column prop="name" label="姓名" width="180">
					</el-table-column>
					<el-table-column prop="address" label="地址">
					</el-table-column>
					<el-table-column label="操作" width="180">
						<template slot-scope="scope">
							<el-button size="small">编辑</el-button>
							<el-button size="small" type="danger" @click="handleDelete(scope.$index, scope.row)">删除</el-button>
						</template>
					</el-table-column>
				</el-table>
				<el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage"
				 :page-sizes="[1, 2, 3, 4]" :page-size="pageSize" layout="total, sizes, prev, pager, next, jumper" :total="totalItems">
				</el-pagination>

				<!-- 删除提示框 -->
				<el-dialog title="提示" :visible.sync="delVisible" width="300px" center>
					<div class="del-dialog-cnt">删除不可恢复，是否确定删除？</div>
					<span slot="footer" class="dialog-footer">
						<el-button @click="delVisible = false">取 消</el-button>
						<el-button type="primary" @click="deleteRow">确 定</el-button>
					</span>
				</el-dialog>


			</div>

		</div>


		<script type="text/javascript">
			var app = new Vue({
				el: "#content-wrapper",
				data: {
					packData:[],
					delVisible:false, //删除提示弹框的状态
					msg: "", //记录每一条的信息，便于取id
					delarr:[], //存放删除的数据


					tableDataBegin: [{
							PackingId: "1",
							date: "2016-05-01",
							name: "王小虎",
							address: "上海市普陀区金沙江路 1518 弄"
						},
						{
							PackingId: "2",
							date: "2016-05-02",
							name: "王小虎",
							address: "上海市普陀区金沙江路 1517 弄"
						},
						{
							PackingId: "3",
							date: "2016-05-03",
							name: "王二虎",
							address: "上海市普陀区金沙江路 1519 弄"
						},
						{
							PackingId: "4",
							date: "2016-05-04",
							name: "王二虎",
							address: "上海市普陀区金沙江路 1516 弄"
						},
						{
							PackingId: "5",
							date: "2016-05-05",
							name: "王三虎",
							address: "上海市普陀区金沙江路 1518 弄"
						},
						{
							PackingId: "6",
							date: "2016-05-06",
							name: "王三虎",
							address: "上海市普陀区金沙江路 1517 弄"
						},
						{
							PackingId: "7",
							date: "2016-05-07",
							name: "王小虎",
							address: "上海市普陀区金沙江路 1519 弄"
						},
						{
							PackingId: "8",
							date: "2016-05-08",
							name: "王小虎",
							address: "上海市普陀区金沙江路 1516 弄"
						}
					],
					tableDataName: "",
					tableDataEnd: [],
					currentPage: 2,
					pageSize: 8,
					totalItems: 0,
					filterTableDataEnd: [],
					flag: false
				},
				created: function() {
					this.totalItems = this.tableDataBegin.length;
					if (this.totalItems > this.pageSize) {
						for (let index = 0; index < this.pageSize; index++) {
							this.tableDataEnd.push(this.tableDataBegin[index]);
						}
					} else {
						this.tableDataEnd = this.tableDataBegin;
					}
				},
				methods: {
					//前端搜索功能需要区分是否检索,因为对应的字段的索引不同
					//用两个变量接收currentChangePage函数的参数
					doFilter() {
						if (this.tableDataName == "") {
							this.$message.warning("查询条件不能为空！");
							return;
						}
						this.tableDataEnd = []
						//每次手动将数据置空,因为会出现多次点击搜索情况
						this.filterTableDataEnd = []
						this.tableDataBegin.forEach((value, index) => {
							if (value.name) {
								if (value.name.indexOf(this.tableDataName) >= 0) {
									this.filterTableDataEnd.push(value)
								}
							}
						});
						//页面数据改变重新统计数据数量和当前页
						this.currentPage = 1
						this.totalItems = this.filterTableDataEnd.length
						//渲染表格,根据值
						this.currentChangePage(this.filterTableDataEnd)
						//页面初始化数据需要判断是否检索过
						this.flag = true
					},
					openData() {},
					handleSizeChange(val) {
						console.log(`每页 ${val} 条`);
						this.pageSize = val;
						this.handleCurrentChange(1);

					},
					handleCurrentChange(val) {
						console.log(`当前页: ${val}`);
						this.currentPage = val;
						//需要判断是否检索
						if (!this.flag) {
							this.currentChangePage(this.tableDataBegin);
							console.log(this.tableDataEnd);
						} else {
							this.currentChangePage(this.filterTableDataEnd);
							console.log(this.tableDataEnd);
						}
					}, //组件自带监控当前页码

					currentChangePage(list) {
						let from = (this.currentPage - 1) * this.pageSize;
						let to = this.currentPage * this.pageSize;
						this.tableDataEnd = [];
						for (; from < to; from++) {
							if (list[from]) {
								this.tableDataEnd.push(list[from]);
							}
						}
					},
					//单行删除
					handleDelete(index, row) {
						this.idx = index;
						this.msg = row; //每一条数据的记录
						this.delarr.push(this.msg.PackingId); //把单行删除的每条数据的id添加进放删除数据的数组
						this.delVisible = true;
						console.log(this.delarr);
					},

				},
				mounted: function() {

				},

			})
		</script>

	</body>
</html>
